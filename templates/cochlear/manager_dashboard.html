{% extends "cochlear_base.html" %}

{% block cochlear-content %}

{% load staticfiles %}
<!-- Load our stylesheet -->
<link href="{% static 'cochlear/manager-dashboard.css' %}" rel="stylesheet">
<!-- Include external alphanumeric sorting for strings -->
<script type="text/javascript" src="{% static 'cochlear/js/alphanum.js' %}"></script>
<!-- Magnific Popup core CSS file -->
<link href="{% static 'cochlear/magnific-popup.css' %}" rel="stylesheet">
<!-- Magnific Popup core JS file -->
<script src="{% static 'cochlear/js/jquery.magnific-popup.min.js' %}"></script>
<link href="{% static 'cochlear/popup.css' %}" rel="stylesheet">
<!-- include once per page where Dropzone is used -->
<script src="{% static 'cochlear/js/dropzone.js' %}"></script>
<link href="{% static 'cochlear/dropzone.css' %}" rel="stylesheet">

<div class="container"><!-- This is a bootstrap class -->
	<h3> {{welcome_msg}}, {{name}}! </h3>
	<hr>

	<center><h2>Get Data</h2></center>
	<h3>Download as a CSV</h3>
	<ro>
	<a href="{% url 'cochlear:getAllUserDataCSV' %}">	
		<button type="button" class="btn btn-primary"> Get All User Data </button> 
	</a>
	<br/>

	<a href="{% url 'cochlear:talkerIDCSV' %}">	
		<button type="button" class="btn btn-primary"> Speaker ID </button> 
	</a>
	<br/>
	<a href="{% url 'cochlear:meaningfulCSV' %}">	
		<button type="button" class="btn btn-primary"> (Open Set) Meaningful Sentence </button> 
	</a>
	<a href="{% url 'cochlear:anomalousCSV' %}">	
		<button type="button" class="btn btn-primary"> (Open Set) Anomalous Sentence </button> 
	</a>
	<a href="{% url 'cochlear:wordCSV' %}">	
		<button type="button" class="btn btn-primary"> (Open Set) Word </button> 
	</a>
	<a href="{% url 'cochlear:otherCSV' %}">	
		<button type="button" class="btn btn-primary"> (Open Set) Other </button>
	</a>
	<br/> 
	<a href="{% url 'cochlear:cstPhonemeCSV' %}">	
		<button type="button" class="btn btn-primary"> (Closed Set Text) Phoneme </button> 
	</a>
	<a href="{% url 'cochlear:cstEnvironmentalCSV' %}">	
		<button type="button" class="btn btn-primary"> (Closed Set Text) Environmental </button> 
	</a>
	<a href="{% url 'cochlear:cstOtherCSV' %}">	
		<button type="button" class="btn btn-primary"> (Closed Set Text) Other </button> 
	</a>

	<center><h2>Speech & Speakers</h2></center>
	<h3>Speech Files</h3>
	<a href="#speechfiles_popup" type="button" class="btn btn-success addbtn" id="speechfiles_addbtn"><i class="fa fa-plus upload-new-icon" aria-hidden="true"></i>Add New</a>
	{% include "cochlear/embeds/file_list.html" with data=speechFileList %}
	{% include "cochlear/embeds/speechfiles_popup.html" %}

	<h3>Speakers</h3>
	{% include "cochlear/embeds/file_list.html" with data=speakerFileList %}

	<center><h2>Training Modules</h2></center>
	<h3>Closed Set Text</h3>
	<p>A test sound with closed set, text-based responses.</p>
	<a href="{% url 'cochlear:closedsettextAdd' %}" type="button" class="btn btn-success addbtn"><i class="fa fa-plus upload-new-icon" aria-hidden="true"></i>Add New</a>
	{% include "cochlear/embeds/file_list.html" with data=closedSetText %}
	
	<h3>Open Set</h3>
	<p>A test sound with an open-set response.</p>
	<a href="{% url 'cochlear:opensetAdd' %}" type="button" class="btn btn-success addbtn"><i class="fa fa-plus upload-new-icon" aria-hidden="true"></i>Add New</a>
	{% include "cochlear/embeds/file_list.html" with data=openSet %}


	<h3>Speaker Identification</h3>
	<p>An unknown speaker that must be identified after listening to a set of known speakers.</p>
	<a href="{% url 'cochlear:speakeridAdd' %}" type="button" class="btn btn-success addbtn"><i class="fa fa-plus upload-new-icon" aria-hidden="true"></i>Add New</a>
	{% include "cochlear/embeds/file_list.html" with data=speakerid %}

	<br>
	
	<script type="text/javascript" src="{% static 'cochlear/js/file_list.js' %}"></script>
	<script type="text/javascript">
	function RefreshData(){
		//Refreshes the data. Called by each popup after it closes
		function success(data){
			//Put the data in for the sound files
			function refreshList(name,id){
				var soundFiles = data[name]['rows']
				itemList = $("#"+id+"_items")
				itemList.empty()//clear it
				//Add the new items 
				var child = "<tbody>"
				for(var i=0;i<soundFiles.length;i++){
					var row = soundFiles[i]
					child += "<tr>"
					for(var j=0;j<soundFiles[i].length;j++){
						child += '<td class="col-md-'+data[name]['colSize']+ ' '+id+'_items_'+String(j)+'">'+String(soundFiles[i][j])+'</td>'
					}
					child += "</tr>"
				}
				child += "</tbody>"
				itemList.append(child)
			}
			refreshList('speechFileList','speechfiles')
			refreshList('speakerFileList','speakerfiles')

		}
		function fail(msg){
			console.log("Failed to refresh!",msg)
		}
		$.get('{% url "cochlear:getDashboardData" %}',success).fail(fail)
	}
	</script>
</div>

{% endblock %}
